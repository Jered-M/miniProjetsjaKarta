<!DOCTYPE html>
<html>
<head>
    <title>StockLoc</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: #0f172a; color: #f8fafc; min-height: 100vh; }
        .app { display: flex; height: 100vh; }
        .sidebar { width: 260px; background: rgba(15,23,42,0.95); border-right: 1px solid rgba(100,116,139,0.2); padding: 24px; overflow-y: auto; position: fixed; height: 100vh; left: 0; }
        .main { flex: 1; overflow-y: auto; padding: 32px; margin-left: 260px; }
        .header h1 { font-size: 2em; margin-bottom: 8px; }
        .header p { color: #64748b; }
        .nav { display: flex; flex-direction: column; gap: 8px; margin-top: 30px; }
        .nav-btn { padding: 12px 16px; border: none; background: transparent; color: #cbd5e1; cursor: pointer; border-radius: 8px; transition: all 0.3s; text-align: left; }
        .nav-btn:hover { background: rgba(100,116,139,0.15); color: #0ea5e9; }
        .nav-btn.active { background: rgba(14,165,233,0.15); color: #0ea5e9; border-left: 3px solid #0ea5e9; padding-left: 13px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 30px 0; }
        .card { background: linear-gradient(135deg, rgba(30,41,59,0.9) 0%, rgba(15,23,42,0.7) 100%); border: 1px solid rgba(100,116,139,0.2); border-radius: 12px; padding: 24px; }
        .card h3 { margin-bottom: 16px; }
        input, select, button { background: rgba(30,41,59,0.6); border: 1px solid rgba(100,116,139,0.2); border-radius: 8px; padding: 12px; color: #f8fafc; font-size: 0.95em; }
        button { background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%); color: white; border: none; cursor: pointer; }
        button:hover { transform: translateY(-2px); }
        .view { display: none; }
        .view.active { display: block; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 16px; text-align: left; border-bottom: 1px solid rgba(100,116,139,0.1); }
        th { background: rgba(14,165,233,0.1); font-weight: 600; }
    </style>
</head>
<body>
    <div class="app">
        <div class="sidebar">
            <h2>📦 StockLoc</h2>
            <p style="color: #64748b; margin-bottom: 30px; font-size: 0.9em;">Service Emplacement</p>
            <div class="nav">
                <button class="nav-btn active" onclick="showView('dash')">📊 Dashboard</button>
                <button class="nav-btn" onclick="showView('prod')">📦 Produits</button>
                <button class="nav-btn" onclick="showView('rpt')">📈 Rapports</button>
                <button class="nav-btn" onclick="showView('notif')">🔔 Notifications</button>
            </div>
        </div>
        <div class="main">
            <div id="dash" class="view active">
                <div class="header">
                    <h1>📊 Tableau de Bord</h1>
                    <p>Vue d'ensemble</p>
                </div>
                <div class="grid">
                    <div class="card"><h3>📦 1,240</h3><p style="color: #64748b;">Produits</p></div>
                    <div class="card"><h3>⚠️ 8</h3><p style="color: #64748b;">Ruptures</p></div>
                    <div class="card"><h3>💰 5,800€</h3><p style="color: #64748b;">Ventes</p></div>
                    <div class="card"><h3>📍 45</h3><p style="color: #64748b;">Emplacements</p></div>
                </div>
                <div class="card" style="margin-top: 30px;">
                    <h3>Assigner Emplacement</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin: 16px 0;">
                        <input type="text" placeholder="SKU" id="sku" value="SKU001">
                        <input type="text" placeholder="Produit" id="name" value="Chaise">
                        <input type="text" placeholder="Emplacement" id="loc" value="A1-01">
                        <input type="number" placeholder="Quantité" id="qty" value="50">
                    </div>
                    <button onclick="assignLocation()" style="width: 100%;">Assigner</button>
                </div>
                <div id="result" style="display: none; margin-top: 30px; padding: 20px; background: rgba(16,185,129,0.15); border-radius: 8px; border: 1px solid rgba(16,185,129,0.3);"></div>
            </div>

            <div id="prod" class="view">
                <div class="header">
                    <h1>📦 Produits</h1>
                    <p>Gestion des emplacements</p>
                </div>
                <div class="card">
                    <table>
                        <thead>
                            <tr><th>Produit</th><th>SKU</th><th>Emplacement</th><th>Quantité</th><th>Statut</th></tr>
                        </thead>
                        <tbody id="prodTable">
                            <tr><td colspan="5" style="text-align: center; color: #64748b;">Chargement...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="rpt" class="view">
                <div class="header">
                    <h1>📈 Rapports</h1>
                    <p>Analysez vos données</p>
                </div>
                <div class="card">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 16px;">
                        <input type="date" id="from">
                        <input type="date" id="to">
                        <select id="groupBy"><option value="month">Par mois</option><option value="day">Par jour</option></select>
                    </div>
                    <button onclick="generateReport()" style="width: 100%;">Générer</button>
                </div>
                <div id="reportResult" style="display: none; margin-top: 30px; padding: 20px; background: rgba(14,165,233,0.1); border-radius: 8px; border: 1px solid rgba(14,165,233,0.3);"></div>
            </div>

            <div id="notif" class="view">
                <div class="header">
                    <h1>🔔 Notifications</h1>
                    <p>Alertes récentes</p>
                </div>
                <div class="card">
                    <div style="padding: 16px; border-bottom: 1px solid rgba(100,116,139,0.2);"><strong>⚠️ Stock faible:</strong> SKU001 en rupture</div>
                    <div style="padding: 16px;"><strong>✅ Vente enregistrée:</strong> 2 unités vendues</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function showView(name) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById(name).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
        }

        async function assignLocation() {
            const data = {
                sku: document.getElementById('sku').value,
                name: document.getElementById('name').value,
                locationCode: document.getElementById('loc').value,
                stockQuantity: parseInt(document.getElementById('qty').value)
            };
            try {
                const res = await fetch('/miniProjet-1.0/resources/emplacements', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = document.getElementById('result');
                result.style.display = 'block';
                result.innerHTML = '<h3 style="color: #10b981;">Succes!</h3><pre>' + JSON.stringify(await res.json(), null, 2) + '</pre>';
            } catch(e) {
                const result = document.getElementById('result');
                result.style.display = 'block';
                result.style.background = 'rgba(239,68,68,0.15)';
                result.style.borderColor = 'rgba(239,68,68,0.3)';
                result.innerHTML = '<h3 style="color: #ef4444;">Erreur!</h3><p>' + e.message + '</p>';
            }
        }

        async function generateReport() {
            const from = document.getElementById('from').value;
            const to = document.getElementById('to').value;
            const groupBy = document.getElementById('groupBy').value;
            let url = '/miniProjet-1.0/resources/reports/sales?groupBy=' + groupBy;
            if(from) url += '&from=' + from;
            if(to) url += '&to=' + to;
            try {
                const res = await fetch(url);
                const result = document.getElementById('reportResult');
                result.style.display = 'block';
                result.innerHTML = '<h3 style="color: #10b981;">Rapport genere!</h3><pre>' + JSON.stringify(await res.json(), null, 2) + '</pre>';
            } catch(e) {
                const result = document.getElementById('reportResult');
                result.style.display = 'block';
                result.style.background = 'rgba(239,68,68,0.15)';
                result.style.borderColor = 'rgba(239,68,68,0.3)';
                result.innerHTML = '<h3 style="color: #ef4444;">Erreur!</h3><p>' + e.message + '</p>';
            }
        }

        async function loadProducts() {
            try {
                const res = await fetch('/miniProjet-1.0/resources/emplacements/all');
                const products = await res.json();
                const table = document.getElementById('prodTable');
                if(Array.isArray(products) && products.length > 0) {
                    table.innerHTML = products.map(p => `
                        <tr>
                            <td>${p.name}</td>
                            <td style="font-family: monospace; color: #64748b;">${p.sku}</td>
                            <td style="color: #0ea5e9;">${p.locationCode}</td>
                            <td>${p.stockQuantity}</td>
                            <td>${p.stockQuantity > 20 ? '✅ En stock' : p.stockQuantity > 0 ? '⚠️ Faible' : '❌ Rupture'}</td>
                        </tr>
                    `).join('');
                } else {
                    table.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #64748b;">Aucun produit</td></tr>';
                }
            } catch(e) {
                document.getElementById('prodTable').innerHTML = '<tr><td colspan="5" style="color: #ef4444;">Erreur de chargement: ' + e.message + '</td></tr>';
                console.error('Erreur:', e);
            }
        }

        // Load products when switching tabs
        document.querySelectorAll('.nav-btn')[1].addEventListener('click', loadProducts);
        
        // Charger les produits au démarrage
        window.addEventListener('DOMContentLoaded', loadProducts);
    </script>
</body>
</html>
