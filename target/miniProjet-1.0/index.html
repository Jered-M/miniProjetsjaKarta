<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StockLoc - Gestion Inventaire</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
        }

        html,
        body {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #0f172a;
            color: #e2e8f0;
        }

        #root {
            height: 100%;
            width: 100%;
        }

        .sidebar {
            background: #1e293b;
            border-right: 1px solid #334155;
        }

        .nav-item {
            color: #94a3b8;
            transition: all 0.3s;
            cursor: pointer;
            padding: 12px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .nav-item:hover {
            background: #334155;
            color: #f1f5f9;
        }

        .nav-item.active {
            background: #3b82f6;
            color: white;
            font-weight: 600;
        }

        .header {
            background: #1e293b;
            border-bottom: 1px solid #334155;
        }

        .stat-card {
            background: #334155;
            border: 1px solid #475569;
            border-radius: 8px;
            padding: 16px;
            transition: all 0.3s;
        }

        .stat-card:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .btn-primary:hover {
            background: #2563eb;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }

        .table-row {
            border-bottom: 1px solid #334155;
            padding: 12px 0;
            display: grid;
            grid-template-columns: 80px 1fr 120px 80px 150px 40px;
            align-items: center;
            gap: 16px;
        }

        .table-row:hover {
            background: rgba(59, 130, 246, 0.1);
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 24px;
            width: 90%;
            max-width: 500px;
        }

        .modal input,
        .modal select {
            width: 100%;
            padding: 8px 12px;
            background: #0f172a;
            border: 1px solid #334155;
            color: #f1f5f9;
            border-radius: 6px;
            margin-top: 6px;
        }

        .badge-rupture {
            background: #ef4444;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .icon {
            width: 20px;
            height: 20px;
            display: inline-block;
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const API_BASE = 'http://localhost:8080/miniProjet/api';

        // SVG Icons
        const PackageIcon = () => <svg className="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" /><polyline points="3.27 6.96 12 12.01 20.73 6.96" /><line x1="12" y1="22.08" x2="12" y2="12" /></svg>;
        const AlertIcon = () => <svg className="icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z" /></svg>;
        const EuroIcon = () => <svg className="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M15 6H9a6 6 0 0 0 0 12h6" /><path d="M13 15H7a4 4 0 0 1 0-8h6" /></svg>;
        const MapPinIcon = () => <svg className="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" /><circle cx="12" cy="10" r="3" /></svg>;
        const DashboardIcon = () => <svg className="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><rect x="3" y="3" width="7" height="7" /><rect x="14" y="3" width="7" height="7" /><rect x="14" y="14" width="7" height="7" /><rect x="3" y="14" width="7" height="7" /></svg>;
        const BellIcon = () => <svg className="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9" /><path d="M13.73 21a2 2 0 0 1-3.46 0" /></svg>;
        const BarChartIcon = () => <svg className="icon" viewBox="0 0 24 24" fill="currentColor"><rect x="3" y="13" width="4" height="8" /><rect x="10" y="5" width="4" height="16" /><rect x="17" y="9" width="4" height="12" /></svg>;
        const SearchIcon = () => <svg className="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="11" cy="11" r="8" /><line x1="21" y1="21" x2="16.65" y2="16.65" /></svg>;
        const PlusIcon = () => <svg className="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><line x1="12" y1="5" x2="12" y2="19" /><line x1="5" y1="12" x2="19" y2="12" /></svg>;

        const StockLoc = () => {
            // RAPPORTS (doivent √™tre ici, pas dans le JSX)
            const fetchStockOut = async () => {
                setReportLoading(true);
                setReportError('');
                try {
                    console.log('Appel de /reports/stock-out...');
                    const res = await fetch(`${API_BASE}/reports/stock-out`);
                    console.log('R√©ponse re√ßue:', res.status);
                    if (res.ok) {
                        const data = await res.json();
                        console.log('Donn√©es rupture:', data);
                        setStockOut(data);
                        setReportsFetched(prev => ({ ...prev, stockOut: true }));
                    } else {
                        setStockOut([]);
                        setReportError(`Erreur API (${res.status}): Impossible de r√©cup√©rer les ruptures.`);
                    }
                } catch (e) {
                    console.error('Erreur fetch stock-out:', e);
                    setStockOut([]);
                    setReportError('Erreur r√©seau : V√©rifiez que le serveur est lanc√© et que /api/reports/stock-out est accessible.');
                } finally {
                    setReportLoading(false);
                }
            };

            const fetchSalesReport = async () => {
                setReportLoading(true);
                setReportError('');
                try {
                    const today = new Date().toISOString().slice(0, 10);
                    const res = await fetch(`${API_BASE}/reports/sales?from=${today}&to=${today}&groupBy=day`);
                    if (res.ok) {
                        const data = await res.json();
                        setSalesReport(data);
                        setReportsFetched(prev => ({ ...prev, sales: true }));
                    } else {
                        setSalesReport([]);
                        setReportError('Erreur lors de la r√©cup√©ration du rapport de ventes.');
                    }
                } catch (e) {
                    setSalesReport([]);
                    setReportError('Erreur r√©seau lors de la r√©cup√©ration du rapport de ventes.');
                } finally {
                    setReportLoading(false);
                }
            };
            const [activeTab, setActiveTab] = useState('dashboard');
            const [showModal, setShowModal] = useState(false);
            const [showEditModal, setShowEditModal] = useState(false);
            const [editData, setEditData] = useState({ sku: '', location: '' });
            const [products, setProducts] = useState([]);
            const [formData, setFormData] = useState({ sku: '', location: '' });
            const [loading, setLoading] = useState(false);
            const [message, setMessage] = useState('');
            const [apiError, setApiError] = useState('');
            const [stockOut, setStockOut] = useState([]);
            const [salesReport, setSalesReport] = useState([]);
            const [reportLoading, setReportLoading] = useState(false);
            const [reportError, setReportError] = useState('');
            const [reportsFetched, setReportsFetched] = useState({ stockOut: false, sales: false });

            useEffect(() => {
                fetchProducts();
            }, []);

            const fetchProducts = async () => {
                try {
                    setApiError('');
                    const res = await fetch(`${API_BASE}/produits`);
                    if (res.ok) {
                        const data = await res.json();
                        console.log('Produits re√ßus:', data);
                        setProducts(Array.isArray(data) ? data : []);
                    } else {
                        setApiError(`Erreur API: ${res.status}`);
                        setProducts([]);
                    }
                } catch (e) {
                    console.error('Erreur fetch:', e);
                    setApiError(`Erreur: ${e.message}`);
                    setProducts([]);
                }
            };

            // Modification d'emplacement
            const handleEdit = (product) => {
                setEditData({ sku: product.sku, location: product.locationCode || '' });
                setShowEditModal(true);
                setMessage('');
            };

            const handleEditSubmit = async () => {
                if (!editData.sku || !editData.location) {
                    setMessage({ type: 'error', text: 'Veuillez remplir tous les champs' });
                    return;
                }
                setLoading(true);
                setMessage('');
                try {
                    // R√©cup√©rer le produit complet pour remplir le LocationRequest
                    const product = products.find(p => p.sku === editData.sku);
                    const body = {
                        sku: editData.sku,
                        name: product ? product.name : '',
                        locationCode: editData.location,
                        locationNote: editData.location,
                        stockQuantity: product ? product.stockQuantity : 0
                    };
                    const res = await fetch(`${API_BASE}/emplacements/${editData.sku}/location`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(body)
                    });
                    if (res.ok) {
                        setMessage({ type: 'success', text: `‚úì Emplacement modifi√© pour ${editData.sku}` });
                        setTimeout(() => {
                            setShowEditModal(false);
                            setEditData({ sku: '', location: '' });
                            setMessage('');
                            fetchProducts();
                        }, 1200);
                    } else {
                        let errMsg = 'Erreur lors de la modification';
                        try {
                            const err = await res.json();
                            errMsg = err.error || errMsg;
                        } catch {
                            errMsg = 'Erreur serveur ou API injoignable';
                        }
                        throw new Error(errMsg);
                    }
                } catch (e) {
                    setMessage({ type: 'error', text: `‚úó ${e.message}` });
                } finally {
                    setLoading(false);
                }
            };

            const handleAssign = async () => {
                if (!formData.sku || !formData.location) {
                    setMessage({ type: 'error', text: 'Veuillez remplir tous les champs' });
                    return;
                }
                setLoading(true);
                setMessage('');
                try {
                    // √âtape 1: V√©rifier ou cr√©er le produit
                    let product = null;
                    const checkRes = await fetch(`${API_BASE}/produits/${formData.sku}`);

                    if (checkRes.ok) {
                        product = await checkRes.json();
                    } else {
                        // Cr√©er le produit s'il n'existe pas
                        const createRes = await fetch(`${API_BASE}/produits`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                sku: formData.sku,
                                name: `Produit ${formData.sku}`,
                                locationCode: formData.location,
                                locationNote: formData.location,
                                stockQuantity: 50
                            })
                        });
                        if (createRes.ok) {
                            product = await createRes.json();
                        } else {
                            throw new Error('Impossible de cr√©er le produit');
                        }
                    }

                    // √âtape 2: Assigner l'emplacement
                    const res = await fetch(`${API_BASE}/emplacements`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            sku: formData.sku,
                            locationCode: formData.location,
                            locationNote: formData.location,
                            stockQuantity: 50
                        })
                    });
                    if (res.ok) {
                        setMessage({ type: 'success', text: `‚úì Emplacement assign√© √† ${formData.sku}` });
                        setTimeout(() => {
                            setShowModal(false);
                            setFormData({ sku: '', location: '' });
                            setMessage('');
                            fetchProducts();
                        }, 1500);
                    } else {
                        const err = await res.json();
                        throw new Error(err.error || 'Erreur lors de l\'assignation');
                    }
                } catch (e) {
                    setMessage({ type: 'error', text: `‚úó ${e.message}` });
                    console.error('Erreur:', e);
                } finally {
                    setLoading(false);
                }
            };

            const stats = [
                { label: 'Produits', value: products.length || '12', icon: PackageIcon, color: '#3b82f6' },
                { label: 'Ruptures', value: '8', icon: AlertIcon, color: '#ef4444' },
                { label: 'Ventes', value: '5,800‚Ç¨', icon: EuroIcon, color: '#10b981' },
                { label: 'Emplacements', value: '45', icon: MapPinIcon, color: '#8b5cf6' },
            ];

            return (
                <div style={{ display: 'flex', height: '100vh', background: '#0f172a', color: '#e2e8f0' }}>
                    {/* SIDEBAR */}
                    <aside style={{ width: '280px', background: '#1e293b', borderRight: '1px solid #334155', display: 'flex', flexDirection: 'column', padding: '24px 16px', overflowY: 'auto' }}>
                        <div style={{ marginBottom: '32px' }}>
                            <div style={{ display: 'flex', alignItems: 'center', gap: '8px', color: '#3b82f6', marginBottom: '8px', fontSize: '18px', fontWeight: 'bold' }}>
                                <PackageIcon /> StockLoc
                            </div>
                            <p style={{ fontSize: '10px', fontWeight: 'bold', color: '#64748b', textTransform: 'uppercase', letterSpacing: '1px', margin: 0 }}>Service Emplacement</p>
                        </div>

                        <nav style={{ flex: 1, display: 'flex', flexDirection: 'column', gap: '8px' }}>
                            {[
                                { icon: DashboardIcon, label: 'Dashboard', tab: 'dashboard' },
                                { icon: PackageIcon, label: 'Produits', tab: 'produits' },
                                { icon: MapPinIcon, label: 'Emplacements', tab: 'emplacements' },
                                { icon: BarChartIcon, label: 'Rapports', tab: 'rapports' },
                                { icon: BellIcon, label: 'Notifications', badge: '3', tab: 'notifications' },
                            ].map((item, i) => (
                                <div key={i} className={`nav-item ${activeTab === item.tab ? 'active' : ''}`} style={{
                                    background: activeTab === item.tab ? '#3b82f6' : 'transparent',
                                    color: activeTab === item.tab ? 'white' : '#94a3b8',
                                    fontWeight: activeTab === item.tab ? '600' : '400',
                                }} onClick={() => item.tab && setActiveTab(item.tab)}>
                                    <item.icon /> {item.label}
                                    {item.badge && <span style={{ marginLeft: 'auto', background: '#ef4444', color: 'white', padding: '2px 6px', borderRadius: '4px', fontSize: '10px', fontWeight: 'bold' }}>{item.badge}</span>}
                                </div>
                            ))}
                        </nav>

                        <div style={{ borderTop: '1px solid #334155', paddingTop: '16px' }}>
                            <div style={{ display: 'flex', alignItems: 'center', gap: '12px', padding: '8px', borderRadius: '8px', cursor: 'pointer' }}>
                                <div style={{ width: '36px', height: '36px', borderRadius: '50%', background: 'linear-gradient(to right, #3b82f6, #8b5cf6)', display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'white', fontWeight: 'bold', fontSize: '12px', flexShrink: 0, textAlign: 'center' }}>M JD</div>
                                <div style={{ flex: 1, minWidth: 0 }}>
                                    <p style={{ fontSize: '13px', fontWeight: '600', margin: 0, color: '#f1f5f9' }}>jered</p>
                                    <p style={{ fontSize: '11px', color: '#94a3b8', margin: 0 }}>Minono</p>
                                    <p style={{ fontSize: '10px', color: '#64748b', margin: 0 }}>Admin</p>
                                </div>
                            </div>
                        </div>
                    </aside>

                    {/* MAIN CONTENT */}
                    <div style={{ flex: 1, display: 'flex', flexDirection: 'column', overflow: 'hidden' }}>
                        {/* HEADER */}
                        <header style={{ background: '#1e293b', borderBottom: '1px solid #334155', padding: '16px 24px', display: 'flex', justifyContent: 'space-between', alignItems: 'center', gap: '16px' }}>
                            <div style={{ display: 'flex', alignItems: 'center', gap: '8px', background: '#0f172a', border: '1px solid #334155', borderRadius: '6px', padding: '8px 12px', color: '#94a3b8', flex: 1, maxWidth: '300px' }}>
                                <SearchIcon />
                                <input placeholder="Rechercher..." style={{ background: 'transparent', border: 'none', color: '#e2e8f0', outline: 'none', flex: 1, fontSize: '14px' }} />
                            </div>
                            <button className="btn-primary" onClick={() => setShowModal(true)}>
                                <PlusIcon /> Assigner Emplacement
                            </button>
                        </header>

                        {/* CONTENT */}
                        <main style={{ flex: 1, overflow: 'auto', padding: '24px' }}>
                            {activeTab === 'dashboard' && (
                                <>
                                    <div style={{ marginBottom: '24px' }}>
                                        <h2 style={{ fontSize: '24px', fontWeight: 'bold', marginBottom: '8px', margin: 0 }}>Vue d'ensemble</h2>
                                        <p style={{ color: '#94a3b8', margin: 0 }}>Contr√¥lez l'√©tat de votre stock et de vos zones de stockage.</p>
                                    </div>

                                    {/* STATS GRID */}
                                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))', gap: '16px', marginBottom: '32px' }}>
                                        {stats.map((s, i) => (
                                            <div key={i} className="stat-card">
                                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'start' }}>
                                                    <div>
                                                        <p style={{ color: '#94a3b8', fontSize: '12px', fontWeight: '600', textTransform: 'uppercase', marginBottom: '8px', margin: 0 }}>{s.label}</p>
                                                        <p style={{ fontSize: '28px', fontWeight: 'bold', color: '#f1f5f9', margin: 0 }}>{s.value}</p>
                                                    </div>
                                                    <div style={{ color: s.color, opacity: 0.8 }}>
                                                        <s.icon />
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>

                                    {/* TABLE */}
                                    <div style={{ background: '#1e293b', border: '1px solid #334155', borderRadius: '8px', overflow: 'hidden' }}>
                                        <div style={{ padding: '16px 24px', borderBottom: '1px solid #334155', fontWeight: '600' }}>Assignations R√©centes</div>
                                        <div style={{ padding: '16px 24px' }}>
                                            {products.slice(0, 3).map((p, i) => (
                                                <div key={i} className="table-row">
                                                    <span style={{ fontSize: '12px', color: '#94a3b8' }}>#{p.id}</span>
                                                    <span>{p.name}</span>
                                                    <span style={{ fontSize: '12px', color: '#94a3b8' }}>Produit</span>
                                                    <span>{p.stockQuantity === 0 ? <span className="badge-rupture">RUPTURE</span> : p.stockQuantity + ' u.'}</span>
                                                    <span style={{ color: '#94a3b8', fontSize: '12px' }}>{p.locationCode}</span>
                                                    <span style={{ cursor: 'pointer', color: '#3b82f6', fontSize: '18px' }}>‚ãØ</span>
                                                </div>
                                            ))}
                                            {products.length === 0 && <p style={{ textAlign: 'center', color: '#94a3b8' }}>Aucun produit disponible</p>}
                                        </div>
                                    </div>
                                </>
                            )}

                            {activeTab === 'produits' && (
                                <>
                                    <div style={{ marginBottom: '24px' }}>
                                        <h2 style={{ fontSize: '24px', fontWeight: 'bold', marginBottom: '8px', margin: 0 }}>Produits</h2>
                                        <p style={{ color: '#94a3b8', margin: 0 }}>G√©rez vos produits et leurs emplacements de stockage.</p>
                                    </div>
                                    {apiError && <div style={{ padding: '12px', background: '#7f1d1d', color: '#fca5a5', borderRadius: '6px', marginBottom: '16px' }}>Erreur: {apiError}</div>}
                                    <div style={{ background: '#1e293b', border: '1px solid #334155', borderRadius: '8px', overflow: 'hidden' }}>
                                        <div style={{ display: 'grid', gridTemplateColumns: '100px 1fr 150px 120px 100px', gap: '16px', padding: '16px 24px', borderBottom: '1px solid #334155', fontWeight: '600', fontSize: '12px', textTransform: 'uppercase', color: '#94a3b8' }}>
                                            <span>SKU</span>
                                            <span>Produit</span>
                                            <span>Emplacement</span>
                                            <span>Stock</span>
                                            <span>√âtat</span>
                                        </div>
                                        <div style={{ padding: '16px 24px' }}>
                                            {products && products.length > 0 ? products.map((p, i) => (
                                                <div key={i} style={{ display: 'grid', gridTemplateColumns: '100px 1fr 150px 120px 100px 60px', gap: '16px', padding: '12px 0', borderBottom: '1px solid #334155', alignItems: 'center' }}>
                                                    <span style={{ color: '#3b82f6', fontFamily: 'monospace', fontSize: '12px', fontWeight: '600' }}>{p.sku}</span>
                                                    <span style={{ color: '#f1f5f9' }}>{p.name}</span>
                                                    <span style={{ color: '#94a3b8', fontSize: '14px' }}>{p.locationCode || '‚Äî'}</span>
                                                    <span style={{ color: '#10b981', fontWeight: '600' }}>{p.stockQuantity || 0} u.</span>
                                                    <span>{(p.stockQuantity === 0 || p.stockQuantity === null) ? <span className="badge-rupture">RUPTURE</span> : <span style={{ color: '#10b981', fontSize: '12px', fontWeight: '600' }}>‚úì OK</span>}</span>
                                                    <button className="btn-primary" style={{ padding: '4px 8px', fontSize: '12px' }} onClick={() => handleEdit(p)}>Modifier</button>
                                                </div>
                                            )) : <p style={{ textAlign: 'center', color: '#94a3b8', padding: '24px' }}>Aucun produit disponible</p>}
                                        </div>
                                    </div>
                                </>
                            )}

                            {activeTab === 'emplacements' && (
                                <>
                                    <div style={{ marginBottom: '24px' }}>
                                        <h2 style={{ fontSize: '24px', fontWeight: 'bold', marginBottom: '8px', margin: 0 }}>Emplacements</h2>
                                        <p style={{ color: '#94a3b8', margin: 0 }}>Vue des zones de stockage et leurs contenus.</p>
                                    </div>
                                    <div style={{ background: '#1e293b', border: '1px solid #334155', borderRadius: '8px', overflow: 'hidden' }}>
                                        <div style={{ display: 'grid', gridTemplateColumns: '150px 1fr 100px 120px 80px', gap: '16px', padding: '16px 24px', borderBottom: '1px solid #334155', fontWeight: '600', fontSize: '12px', textTransform: 'uppercase', color: '#94a3b8' }}>
                                            <span>Emplacement</span>
                                            <span>Produit</span>
                                            <span>SKU</span>
                                            <span>Quantit√©</span>
                                            <span>√âtat</span>
                                        </div>
                                        <div style={{ padding: '16px 24px' }}>
                                            {products && products.length > 0 ? products.filter(p => p.locationCode).map((p, i) => (
                                                <div key={i} style={{ display: 'grid', gridTemplateColumns: '150px 1fr 100px 120px 80px', gap: '16px', padding: '12px 0', borderBottom: '1px solid #334155', alignItems: 'center' }}>
                                                    <span style={{ color: '#3b82f6', fontFamily: 'monospace', fontSize: '14px', fontWeight: '600' }}>{p.locationCode}</span>
                                                    <span style={{ color: '#f1f5f9' }}>{p.name}</span>
                                                    <span style={{ color: '#94a3b8', fontSize: '12px' }}>{p.sku}</span>
                                                    <span style={{ color: '#10b981', fontWeight: '600' }}>{p.stockQuantity || 0} u.</span>
                                                    <span>{(p.stockQuantity === 0 || p.stockQuantity === null) ? <span style={{ background: '#ef4444', color: 'white', padding: '4px 8px', borderRadius: '4px', fontSize: '11px', fontWeight: '600' }}>VIDE</span> : <span style={{ color: '#10b981', fontSize: '12px', fontWeight: '600' }}>‚úì OK</span>}</span>
                                                </div>
                                            )) : <p style={{ textAlign: 'center', color: '#94a3b8', padding: '24px' }}>Aucun emplacement configur√©</p>}
                                        </div>
                                    </div>
                                </>
                            )}

                            {activeTab === 'rapports' && (
                                <>
                                    <div style={{ marginBottom: '24px' }}>
                                        <h2 style={{ fontSize: '24px', fontWeight: 'bold', marginBottom: '8px', margin: 0 }}>Rapports</h2>
                                        <p style={{ color: '#94a3b8', margin: 0 }}>Analysez les ventes et l'inventaire.</p>
                                    </div>
                                    <div style={{ display: 'flex', gap: '16px', marginBottom: '24px' }}>
                                        <button className="btn-primary" onClick={fetchStockOut} disabled={reportLoading}>Produits en rupture</button>
                                        <button className="btn-primary" onClick={fetchSalesReport} disabled={reportLoading}>Rapport ventes (jour)</button>
                                    </div>
                                    {reportLoading && <p style={{ color: '#3b82f6' }}>‚è≥ Chargement des donn√©es...</p>}
                                    {reportError && <div style={{ color: '#ef4444', background: 'rgba(239, 68, 68, 0.1)', border: '1px solid #ef4444', padding: '12px', borderRadius: '6px', margin: '12px 0' }}>{reportError}</div>}

                                    {/* Rupture de stock */}
                                    {reportsFetched.stockOut && (
                                        <div style={{ marginBottom: '24px', background: '#1e293b', padding: '20px', borderRadius: '8px', border: '1px solid #334155' }}>
                                            <h4 style={{ color: '#ef4444', margin: '0 0 16px 0', display: 'flex', alignItems: 'center', gap: '8px' }}>
                                                <AlertIcon /> Produits en rupture de stock
                                            </h4>
                                            {stockOut.length > 0 ? (
                                                <div style={{ display: 'grid', gap: '8px' }}>
                                                    {stockOut.map((p, i) => (
                                                        <div key={i} style={{ padding: '10px', background: '#0f172a', borderRadius: '4px', borderLeft: '4px solid #ef4444', display: 'flex', justifyContent: 'space-between' }}>
                                                            <span><strong>{p.sku}</strong> - {p.name}</span>
                                                            <span style={{ color: '#94a3b8' }}>üìç {p.locationCode}</span>
                                                        </div>
                                                    ))}
                                                </div>
                                            ) : (
                                                <p style={{ color: '#10b981', margin: 0, fontWeight: '600' }}>‚úÖ Aucun produit en rupture de stock actuellement.</p>
                                            )}
                                        </div>
                                    )}

                                    {/* Rapport ventes */}
                                    {reportsFetched.sales && (
                                        <div style={{ background: '#1e293b', padding: '20px', borderRadius: '8px', border: '1px solid #334155' }}>
                                            <h4 style={{ color: '#3b82f6', margin: '0 0 16px 0', display: 'flex', alignItems: 'center', gap: '8px' }}>
                                                <BarChartIcon /> Ventes du jour (agr√©g√©es)
                                            </h4>
                                            {salesReport.length > 0 ? (
                                                <div style={{ display: 'grid', gap: '8px' }}>
                                                    {salesReport.map((r, i) => (
                                                        <div key={i} style={{ padding: '10px', background: '#0f172a', borderRadius: '4px', borderLeft: '4px solid #3b82f6', display: 'flex', justifyContent: 'space-between' }}>
                                                            <span>üìÖ {r.date || r.period}</span>
                                                            <span><strong>{r.totalSales}</strong> ventes | <strong>{r.totalAmount} ‚Ç¨</strong></span>
                                                        </div>
                                                    ))}
                                                </div>
                                            ) : (
                                                <p style={{ color: '#94a3b8', margin: 0 }}>Aucune vente enregistr√©e pour aujourd'hui.</p>
                                            )}
                                        </div>
                                    )}
                                </>
                            )}
                            {/* MODAL MODIFICATION EMPLACEMENT */}
                            {showEditModal && (
                                <div className="modal-overlay" onClick={() => setShowEditModal(false)}>
                                    <div className="modal" onClick={e => e.stopPropagation()}>
                                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '24px' }}>
                                            <h3 style={{ fontSize: '18px', fontWeight: 'bold', margin: 0 }}>Modifier l'emplacement</h3>
                                            <button style={{ background: 'none', border: 'none', color: '#94a3b8', cursor: 'pointer', fontSize: '24px' }} onClick={() => setShowEditModal(false)}>√ó</button>
                                        </div>
                                        {message && (
                                            <div style={{ padding: '12px', borderRadius: '6px', marginBottom: '16px', background: message.type === 'error' ? '#7f1d1d' : '#064e3b', color: message.type === 'error' ? '#fca5a5' : '#86efac', fontSize: '14px', fontWeight: '500' }}>
                                                {message.text}
                                            </div>
                                        )}
                                        <div style={{ marginBottom: '16px' }}>
                                            <label style={{ fontSize: '14px', fontWeight: '600', display: 'block', marginBottom: '6px', color: '#e2e8f0' }}>SKU</label>
                                            <input type="text" value={editData.sku} disabled style={{ background: '#334155' }} />
                                        </div>
                                        <div style={{ marginBottom: '24px' }}>
                                            <label style={{ fontSize: '14px', fontWeight: '600', display: 'block', marginBottom: '6px', color: '#e2e8f0' }}>Nouvel emplacement</label>
                                            <input type="text" placeholder="Ex: All√©e A, √âtag√®re 3" value={editData.location} onChange={e => setEditData({ ...editData, location: e.target.value })} disabled={loading} />
                                        </div>
                                        <button className="btn-primary" style={{ width: '100%', justifyContent: 'center', opacity: loading ? '0.6' : '1', cursor: loading ? 'not-allowed' : 'pointer' }} onClick={handleEditSubmit} disabled={loading}>
                                            {loading ? '‚è≥ Traitement...' : '‚úì Modifier'}
                                        </button>
                                    </div>
                                </div>
                            )}

                            {activeTab === 'notifications' && (
                                <>
                                    <div style={{ marginBottom: '24px' }}>
                                        <h2 style={{ fontSize: '24px', fontWeight: 'bold', marginBottom: '8px', margin: 0 }}>Notifications</h2>
                                        <p style={{ color: '#94a3b8', margin: 0 }}>Alertes et √©v√©nements importants.</p>
                                    </div>
                                    <div style={{ background: '#1e293b', border: '1px solid #334155', borderRadius: '8px', overflow: 'hidden' }}>
                                        <div style={{ padding: '24px', textAlign: 'center' }}>
                                            <p style={{ color: '#94a3b8', margin: 0 }}>Aucune notification pour le moment</p>
                                        </div>
                                    </div>
                                </>
                            )}
                        </main>
                    </div>

                    {/* MODAL */}
                    {showModal && (
                        <div className="modal-overlay" onClick={() => setShowModal(false)}>
                            <div className="modal" onClick={e => e.stopPropagation()}>
                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '24px' }}>
                                    <h3 style={{ fontSize: '18px', fontWeight: 'bold', margin: 0 }}>Assigner un emplacement</h3>
                                    <button style={{ background: 'none', border: 'none', color: '#94a3b8', cursor: 'pointer', fontSize: '24px' }} onClick={() => setShowModal(false)}>√ó</button>
                                </div>
                                {message && (
                                    <div style={{ padding: '12px', borderRadius: '6px', marginBottom: '16px', background: message.type === 'error' ? '#7f1d1d' : '#064e3b', color: message.type === 'error' ? '#fca5a5' : '#86efac', fontSize: '14px', fontWeight: '500' }}>
                                        {message.text}
                                    </div>
                                )}
                                <div style={{ marginBottom: '16px' }}>
                                    <label style={{ fontSize: '14px', fontWeight: '600', display: 'block', marginBottom: '6px', color: '#e2e8f0' }}>Produit</label>
                                    <input type="text" placeholder="SKU du produit" value={formData.sku} onChange={e => setFormData({ ...formData, sku: e.target.value })} disabled={loading} />
                                </div>
                                <div style={{ marginBottom: '24px' }}>
                                    <label style={{ fontSize: '14px', fontWeight: '600', display: 'block', marginBottom: '6px', color: '#e2e8f0' }}>Zone / Emplacement</label>
                                    <input type="text" placeholder="Ex: All√©e A, √âtag√®re 3" value={formData.location} onChange={e => setFormData({ ...formData, location: e.target.value })} disabled={loading} />
                                </div>
                                <button className="btn-primary" style={{ width: '100%', justifyContent: 'center', opacity: loading ? '0.6' : '1', cursor: loading ? 'not-allowed' : 'pointer' }} onClick={handleAssign} disabled={loading}>
                                    {loading ? '‚è≥ Traitement...' : '‚úì Confirmer l\'assignation'}
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        ReactDOM.render(<StockLoc />, document.getElementById('root'));
    </script>
</body>

</html>